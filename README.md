<!-- This file was automatically generated by the `build-harness`. Make all changes to `README.yaml` and run `make readme` to rebuild this file. -->

[![Scale Factory][logo]][website]

# terraform-cloudfront-auth [![Latest Release](https://img.shields.io/github/release/scalefactory/terraform-cloudfront-auth.svg)](https://github.com/scalefactory/terraform-cloudfront-auth/releases/latest) [![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)


A Terraform module to provision a Cloudfront distribution to serve private
content in an S3 bucket with Lamba@Edge Google/Microsoft/Github/Okta/Auth0/Centrify
authentication. Based on [Widen - Cloudfront Auth](https://github.com/Widen/cloudfront-auth/)


---



## Introduction

You should use this module if you have a private S3 bucket that you want to
guard with Google/Microsoft/Github/Okta/Auth0/Centrify authentication.

The Terraform packages up
[cloudfront-auth](https://github.com/Widen/cloudfront-auth/) into a Lambda
function to be used by Cloudfront's
[Lambda@Edge](https://aws.amazon.com/lambda/edge/). A private S3 bucket and
Cloudfront Distribution will also be created.

## Usage

**NOTE**: You will need to create a certificate with AWS Certificate Manager in
the `us-east-1` region. The example below assumes a certificate for the domain
`example.com` already exists.

```hcl
module "cloudfront_auth" {
  source                         = "git::https://github.com/scalefactory/terraform-cloudfront-auth.git?ref=master"

  auth_vendor                    = "github"
  cloudfront_distribution        = "private.example.com"
  client_id                      = "CHANGE_ME"
  client_secret                  = "CHANGE_ME"
  redirect_uri                   = "https://private.example.com/callback"
  github_organization            = "exampleorg"

  bucket_name                    = "private.example.com"
  region                         = "eu-west-1"
  cloudfront_acm_certificate_arn = "${data.aws_acm_certificate.example.arn}"
}

data "aws_acm_certificate" "example" {
  domain   = "example.com"
  statuses = ["ISSUED"]
}
```


## Examples

A Full working example can be found in [example](./example) folder. Please
update the `cloudfront_auth` module parameters. **NOTE**: The certificate will
need validating with email first.


## Inputs

### Provider specific Inputs

Provider specific inputs marked required are only required for the specific auth
vendor. E.g `hd` is not required if you are using the `github` auth vendor.

**Google**
| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| hd | The hosted domain (e.g example.com) | string | `` | yes |
| authz | The authorization method: (1) Hosted Domain - verify email's domain matches that of the given hosted domain\n   (2) HTTP Email Lookup - verify email exists in JSON array located at given HTTP endpoint\n   (3) Google Groups Lookup - verify email exists in one of given Google Groups | string | `1` | yes |

**Microsoft**
| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| authz | The authorization method: (1) Azure AD Login (default)\n   (2) JSON Username Lookup | string | `1` | yes |

**GitHub**
| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| github_organization | The github organization that owns the auth application | string | `` | yes |


### Standard
| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| auth_vendor | The vendor to use for authorisation (google, microsoft, github, okta, auth0, centrify) | string | `` | yes |
| cloudfront_distribution | The FQDN of your cloudfront distribution you want to use to serve your private content (e.g www.example.com) | string | `` | yes |
| client_id | The client id of the auth application| string | `` | yes |
| client_secret | The client secret of the auth application| string | `` | yes |
| session_duration | Session duration in hours | string | `1` | no |
| bucket_name | The name of your S3 bucket | string | `` | yes |
| region | Region to launch your bucket in | string | `` | yes |
| tags | Tags to label resources with (e.g map('dev', 'prod')) | map | `<map>` | no |
| cloudfront_aliases | List of FQDNs to be used as alternative domain names (CNAMES) for Cloudfront | list | `<list>` | no |
| cloudfront_price_class | Cloudfront price classes: `PriceClass_All`, `PriceClass_200`, `PriceClass_100` | string | `PriceClass_All` | no |
| cloudfront_default_root_object | The default root object of the Cloudfront distribution | string | `index.html` | no |
| cloudfront_acm_certificate_arn | The ARN of the ACM managed Certificate for the Cloudfront distribution (e.g arn:aws:acm:us-east-1:111111111111:certificate/40eae56f-3acf-4009-89a5-3f3e0fdba331). **NOTE**: The certificate must be created in the `us-east-1` region to work with Cloudfront | string | `` | yes |

## Outputs

| Name | Description |
|------|-------------|
| s3_bucket | The name of the S3 Bucket |
| cloudfront_arn | ARN of the Cloudfront Distribution |
| cloudfront_id | ID of the Cloudfront Distribution |




## References

For additional context, refer to some of these links.

- [Widen - Cloudfront Auth](https://github.com/Widen/cloudfront-auth/) - This project wraps Terraform around Widen's cloudfront-auth around
- [Terraform](https://terraform.io) - Infrastructure as code


## Help

**Got a question?**

File a GitHub [issue](https://github.com/scalefactory/terraform-cloudfront-auth/issues).

## Support & Learning

Work directly with our team of DevOps experts via email, slack, and video conferencing.

We provide [*commercial support*][commercial_support] for all of our [Open Source][github] projects. As a *Dedicated Support* customer, you have access to our team of subject matter experts at a fraction of the cost of a full-time engineer.

[![E-Mail](https://img.shields.io/badge/info@scalefactory.com-blue.svg)][email]

- **Questions.** High performing organisations give their developers
  self-service access to cloud resources. We'll provide a shared Slack channel
  for your team to talk to our cloud experts.
- **The Scale Factory Academy.** Your team will have access to all of our
  hands-on training workshops run through [The Scale Factory
  Academy][scale_factory_academy].
- **Workload reviews.** We'll help you design secure, performance, available and
  cost-effective cloud infrastructure.
- **Incident Support.** We're available 24x7 by support ticket or on the phone, to get you up and running again, and to offer advice on how to avoid similar problems in future.
- **Regular Checkups.** One of our consultants will visit you every month in order to stay up to date with your plans, review any architectural changes you have in mind, and to keep you updated on industry trends.

## Contributing

### Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/scalefactory/terraform-cloudfront-auth/issues) to report any bugs or file feature requests.

### Developing

We welcome all pull requests to our open source projects. We follow
"fork-and-pull" Git workflow.

 1. **Fork** the repository on GitHub
 2. **Clone** your fork to your local development environment
 3. **Commit** changes to your own branch in your project
 4. **Push** your changes back to GitHub
 5. Submit a **Pull Request** so that we can review your changes

**NOTE:** Be sure to merge the latest changes from "upstream" before making a
pull request!



## Copyrights

Copyright © 2019-2019 [The Scale Factory Ltd.](https://scalefactory.com)




## License

[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

See [LICENSE](LICENSE) for full details.

    Licensed to the Apache Software Foundation (ASF) under one
    or more contributor license agreements.  See the NOTICE file
    distributed with this work for additional information
    regarding copyright ownership.  The ASF licenses this file
    to you under the Apache License, Version 2.0 (the
    "License"); you may not use this file except in compliance
    with the License.  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an
    "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, either express or implied.  See the License for the
    specific language governing permissions and limitations
    under the License.








## About

This project is maintained by [The Scale Factory Ltd.][website]. Like it? Please
give it a ★.

[![Scale Factory][logo]][website]

We're a [DevOps Cloud Infrastructure Consultancy][hire] company based in London,
UK. We love empowering teams to deliver more with [AWS][aws].

We conduct free [AWS Well-Architected Reviews][aws_well_architected] on your AWS
Workloads to ensure that your cloud infrastructure meets the five
well-architected pillars.

We offer [support & learning][commercial_support] to help development teams
deliver more business value.

Check out [our other projects][github], [follow us on twitter][twitter], or [hire us][hire] to help with your cloud strategy and implementation.


### Contributors

|  [![Steve Porter][steveporter92_avatar]][steveporter92_homepage]<br/>[Steve Porter][steveporter92_homepage] |
|---|

  [steveporter92_homepage]: https://github.com/steveporter92
  [steveporter92_avatar]: https://github.com/steveporter92.png?size=150




  [logo]: https://www.scalefactory.com/themes/custom/scalefactory/logo.svg
  [website]: https://scalefactory.com
  [github]: https://github.com/scalefactory
  [hire]: https://www.scalefactory.com/services
  [aws_well_architected]: https://www.scalefactory.com/well-architected
  [aws]: https://aws.amazon.com/
  [linkedin]: https://www.linkedin.com/company/the-scale-factory
  [twitter]: https://twitter.com/scalefactory
  [email]: https://www.scalefactory.com/contact-us
  [commercial_support]: https://www.scalefactory.com/services/support-learning
  [scale_factory_academy]: https://www.scalefactory.com/services/training/the-scale-factory-academy
  [share_twitter]: https://twitter.com/intent/tweet/?text=terraform-cloudfront-auth&url=https://github.com/scalefactory/terraform-cloudfront-auth
  [share_linkedin]: https://www.linkedin.com/shareArticle?mini=true&title=terraform-cloudfront-auth&url=https://github.com/scalefactory/terraform-cloudfront-auth
  [share_reddit]: https://reddit.com/submit/?url=https://github.com/scalefactory/terraform-cloudfront-auth
  [share_facebook]: https://facebook.com/sharer/sharer.php?u=https://github.com/scalefactory/terraform-cloudfront-auth
  [share_email]: mailto:?subject=terraform-cloudfront-auth&body=https://github.com/scalefactory/terraform-cloudfront-auth
